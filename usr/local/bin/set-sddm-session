#!/bin/bash
SESSION_NAME=$(basename "${1:-plasma}" .desktop)
USER_NAME="${2:-$USER}"

# Scrittura autologin
cat > "/etc/sddm.conf.d/zz-steamos-autologin.conf" <<EOF
[Autologin]
User=$USER_NAME
Session=$SESSION_NAME
EOF
sync

# Riavvio pulito di SDDM
systemd-run --unit=steamos-restart --scope bash -c "
    exec > /tmp/switch.log 2>&1
    sleep 2
    systemctl stop sddm
    pkill -9 Xorg || true
    pkill -9 Xwayland || true
    rm -rf /tmp/.X11-unix/X*
    sleep 1
    systemctl start sddm
" &
exit 0
