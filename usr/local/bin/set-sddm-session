#!/bin/bash

# This script overrides the SDDM autologin configuration to set the target session.
# It creates a temporary configuration file that SDDM reads upon restart.

set -e
SESSION_FILE="$1"
USER_NAME="$2"

# Write the autologin configuration using sudo tee to handle permissions
echo -e "[Autologin]\nUser=$USER_NAME\nSession=$SESSION_FILE" | sudo tee "/etc/sddm.conf.d/steamos-switcher.conf" > /dev/null

# Restart SDDM after a second delay to allow a clean exit
systemd-run --on-active=1s --unit=restart-sddm-delay /bin/systemctl restart sddm
