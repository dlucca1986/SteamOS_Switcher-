#!/bin/bash
LOG_FILE="/tmp/os-session-select.log"
exec > "$LOG_FILE" 2>&1

SESSION_INPUT=${1:-"steam"}
USER_NAME=$(id -un)

case "$SESSION_INPUT" in
    "plasma"|"desktop")
        SESSION_FILE="plasma" 
        pkill -u "$USER_NAME" -TERM steam 2>/dev/null
        sleep 1
        ;;
    "gamescope-session-steam"|"steam"|"gaming"|"steamos")
        SESSION_FILE="gamescope-session"
        ;;
    *) exit 1 ;;
esac

# Chiama il binario che si trova ora direttamente in /usr/local/bin/
sudo /usr/local/bin/set-sddm-session "$SESSION_FILE" "$USER_NAME"

if [ $? -eq 0 ]; then
    sync
    loginctl terminate-user "$USER_NAME"
fi
