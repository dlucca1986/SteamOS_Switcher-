#!/bin/bash
# =============================================================================
# SteamMachine-DIY - Release Channel Manager
# =============================================================================
# Script: steamos-select-branch
# Description: Compatibility shim for SteamOS update channels.
#              Ensures UI compatibility without breaking system mirrors.
# Repository: https://github.com/dlucca1986/SteamMachine-DIY
# Path:        /usr/local/bin/steamos-helpers/steamos-select-branch
# License:MIT
# =============================================================================

# --- Configuration & Logging ---
readonly LOG_FILE="/tmp/steamos-diy.log"
readonly BLUE='\033[0;34m'
readonly GREEN='\033[0;32m'
readonly NC='\033[0m'

# Log to both Master Log (for diagnostics) and Console
log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] [Branch-Shim] $1" >> "$LOG_FILE"
}

# --- Main Logic ---

# Arguments handling: Steam passes the branch name (e.g., "stable", "beta")
SELECTED_BRANCH=${1:-"stable"}

log_info "Intercepting branch switch request: ${SELECTED_BRANCH}"

# DIY Hardware Notice:
# We return success to keep the Steam UI responsive. Actual system updates
# are handled by pacman/pamac on the host OS to maintain rolling release stability.
# Modifying mirrors via Steam could lead to partial upgrades or broken dependencies.

log_info "Release channel '${SELECTED_BRANCH}' confirmed (Simulated)."

echo -e "${GREEN}âœ“ Branch selection finalized.${NC}"

# Exit with success to prevent the Steam UI from hanging
exit 0
