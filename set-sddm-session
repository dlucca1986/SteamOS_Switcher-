#!/bin/bash

# This script overrides the SDDM autologin configuration to set the target session.
# It creates a temporary configuration file that SDDM reads upon restart 
# to determine which user and session (Plasma or Gamescope) should start automatically.

set -e
SESSION_FILE="$1"
USER_NAME="$2"

# Write the autologin configuration that SDDM will read on restart
cat > "/etc/sddm.conf.d/z1_current_session.conf" <<EOF
[Autologin]
User=$USER_NAME
Session=$SESSION_FILE
EOF

# Schedule an SDDM restart after a 3-second delay to allow a clean exit
# Using systemd-run prevents the script from hanging during the service restart.
systemd-run --on-active=3s --unit=restart-sddm-delay /bin/systemctl restart sddm
